<!DOCTYPE html>
<html lang="th-TH" style="height: auto; overflow-x: hidden">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, user-scalable=0">
    <title>E-legalizaton</title>
    <meta name="csrf-param" content="_csrf">
    <link href="https://legal.consulargo.io/legailzation/bootstrap.css" rel="stylesheet"/>
    <link href="https://legal.consulargo.io/legailzation/css" rel="stylesheet"/>
    <link href="https://legal.consulargo.io/legailzation/all.min.css" rel="stylesheet"/>
    <link href="https://legal.consulargo.io/legailzation/site.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Prompt:300,400,400i,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="shortcut icon" href="https://legal.consulargo.io/legailzation/favicon1.ico"/>
    <style>
        .loading {
            color: #666;
            font-style: italic;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body class="pace-done sidebar-mini layout-fixed sidebar-collapse bg-primary-light" style="height: auto;">
    <div class="wrapper">
        <!-- Main content -->
        <div class="content">
            <div id="check-sticker" class="bg-light">
                <div id="check-sticker-container">
                    <div class="container">
                        <div class="card">
                            <div class="card-header bg-primary">
                                <div class="d-flex">
                                    <div class="p-1">
                                        <div class="fa-2x">
                                            <i class="bi bi-check-circle" style="color: white; font-weight: bold"></i>
                                        </div>
                                    </div>
                                    <div class="p-1">
                                        <h4 class="mt-sm-2 mb-0 font-weight-bold" style="color: white">
                                            Verified by Ministry of Foreign Affairs, Kingdom of Thailand
                                        </h4>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <img class="check-sticker-watermark" src="https://legal.consulargo.io/legailzation/mfa-logo.png">
                                <h4 class="text-center text-primary font-weight-bold">
                                    (Detail for Legailzation Service)
                                </h4>
                                <div class="row mt-4">
                                    <!-- for Tablet & Desktop -->
                                    <div class="offset-md-1 col-md-10 d-none d-sm-block">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <tbody>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">เลขที่นิติกรณ์ <br> (Legalization No.)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="legalization-no" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">วันเดือนปีนิติกรณ์ <br> (Date of Issue) </td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="issue-date" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">สถานที่นิติกรณ์ <br> (Place of Issue)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="place-of-issue" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">คำรับรองนิติกรณ์เอกสาร <br> (Type of Legalization)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="legalization-type" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">ชื่อและตำแหน่งเจ้าหน้าที่ผู้มีอำนาจลงนาม <br> (Name and Position of Authorized Officer)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="authorized-officer" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">ชื่อเจ้าของเอกสาร <br> (Name of Document's Owner)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="document-owner" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">ประเภทเอกสาร <br> (Type of Document)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="document-type" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    
                                    <!-- for Mobile -->
                                    <div class="col-12 d-block d-sm-none">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <tbody>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">เลขที่นิติกรณ์ <br> (Legalization No.)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="legalization-no-mobile" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">วันเดือนปีนิติกรณ์ <br> (Date of Issue) </td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="issue-date-mobile" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">สถานที่นิติกรณ์ <br> (Place of Issue)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="place-of-issue-mobile" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">คำรับรองนิติกรณ์เอกสาร <br> (Type of Legalization)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="legalization-type-mobile" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">ชื่อและตำแหน่งเจ้าหน้าที่ผู้มีอำนาจลงนาม <br> (Name and Position of Authorized Officer)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="authorized-officer-mobile" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">ชื่อเจ้าของเอกสาร <br> (Name of Document's Owner)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="document-owner-mobile" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                    <tr class="d-flex p-1">
                                                        <td class="col-5">ประเภทเอกสาร <br> (Type of Document)</td>
                                                        <td class="col-1">:</td>
                                                        <td class="col-6">
                                                            <span id="document-type-mobile" class="loading">加载中...</span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 获取URL参数
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // 显示错误信息
        function showError(message) {
            const elements = [
                'legalization-no', 'issue-date', 'place-of-issue', 'legalization-type',
                'authorized-officer', 'document-owner', 'document-type',
                'legalization-no-mobile', 'issue-date-mobile', 'place-of-issue-mobile', 
                'legalization-type-mobile', 'authorized-officer-mobile', 'document-owner-mobile', 'document-type-mobile'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = message;
                    element.className = 'error';
                }
            });
        }

        // 更新内容
        function updateContent(record) {
            const data = {
                'legalization-no': record.legalization_no,
                'issue-date': record.issue_date,
                'place-of-issue': record.place_of_issue,
                'legalization-type': record.legalization_type,
                'authorized-officer': record.authorized_officer,
                'document-owner': record.document_owner,
                'document-type': record.document_type
            };

            // 更新桌面版和移动版
            Object.keys(data).forEach(key => {
                const desktopElement = document.getElementById(key);
                const mobileElement = document.getElementById(key + '-mobile');
                
                if (desktopElement) {
                    desktopElement.textContent = data[key];
                    desktopElement.className = '';
                }
                
                if (mobileElement) {
                    mobileElement.textContent = data[key];
                    mobileElement.className = '';
                }
            });
        }

        // 加载数据
        async function loadData() {
            const qrCode = getQueryParam('qr');
            
            if (!qrCode) {
                showError('缺少QR码参数');
                return;
            }

            try {
                const response = await fetch(`/api/qrcode/info/${qrCode}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 404) {
                        showError('记录未找到或已被隐藏');
                    } else {
                        showError('加载数据失败');
                    }
                    return;
                }

                const data = await response.json();
                updateContent(data.record);
                
            } catch (error) {
                console.error('Error:', error);
                showError('网络错误，请稍后重试');
            }
        }

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
